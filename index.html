<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Грандаксин против</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.7/aframe/build/aframe-ar-nft.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:sans-serif;background:#000;overflow:hidden;height:100vh;color:#fff}
    #ui{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:10}
    #timer{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:#027ACA;color:#fff;padding:12px 32px;border-radius:30px;font-size:2.5em;font-weight:900}
    #progress{position:fixed;top:100px;left:20px;right:20px;display:flex;gap:12px}
    .bar{flex:1;height:40px;background:rgba(255,255,255,0.2);border-radius:20px;overflow:hidden;position:relative}
    .fill{height:100%;width:0%;transition:width .8s}
    #nerv-fill{background:#00859D}#anx-fill{background:#411D6B}#stress-fill{background:#EB4C24}
    #start,#end{position:fixed;inset:0;background:rgba(0,0,0,0.9);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:100}
    button{padding:20px 80px;background:#027ACA;color:#fff;font-size:2em;border:none;border-radius:50px;cursor:pointer}
  </style>
</head>
<body>

<div id="start">
  <h1>ГРАНДАКСИН<br>ПРОТИВ</h1>
  <p style="font-size:1.5em;margin:30px 0">Уничтожьте 30 симптомов за 30 секунд!</p>
  <button id="go">НАЧАТЬ</button>
</div>

<div id="ui" style="display:none">
  <div id="timer">30</div>
  <div id="progress">
    <div class="bar"><div id="nerv-fill" class="fill"></div></div>
    <div class="bar"><div id="anx-fill" class="fill"></div></div>
    <div class="bar"><div id="stress-fill" class="fill"></div></div>
  </div>
</div>

<a-scene embedded arjs="trackingMethod:best;sourceType:webcam;debugUIEnabled:false" renderer="antialias:true" vr-mode-ui="enabled:false">
  <a-assets timeout="60000">
    <a-asset-item id="nerv" src="red.glb"></a-asset-item>
    <a-asset-item id="anx" src="green.glb"></a-asset-item>
    <a-asset-item id="stress" src="blue.glb"></a-asset-item>
    <audio id="boom" src="https://assets.codepen.io/605876/sfx-hit.mp3"></audio>
  </a-assets>

  <a-entity id="models"></a-entity>

  <a-camera>
    <a-cursor color="white"></a-cursor>
  </a-camera>
</a-scene>

<script>
const scores={nerv:0,anx:0,stress:0};
const models=document.getElementById('models');
let active=true,timer;

const pos=[
  "4.5 0.5 -6"," -4.5 0.6 -6","8.5 0.4 -7"," -8.5 0.4 -7","6.5 1.8 -9"," -6.5 1.9 -9","2.5 2.4 -8.5"," -2.5 2.3 -8.5",
  "10.5 1.6 -10"," -10.5 1.6 -10","5.5 3.3 -11"," -5.5 3.3 -11","9.5 3.1 -12"," -9.5 3.1 -12","0 4 -11",
  "7.5 4.8 -13"," -7.5 4.8 -13","3.5 5.3 -14"," -3.5 5.3 -14","11.5 4.6 -14"," -11.5 4.6 -14",
  "6 6 -15.5"," -6 6 -15.5","9 5.7 -16"," -9 5.7 -16","0 6.2 -16","3 5.9 -15"," -3 5.9 -15","1.8 1.2 -5"," -1.8 1.3 -5"
];

document.getElementById('go').onclick=()=>{
  document.getElementById('start').style.display='none';
  document.getElementById('ui').style.display='block';
  sceneEl.style.display='block';

  pos.forEach((p,i)=>{
    const type=['nerv','anx','stress'][i%3];
    const e=document.createElement('a-entity');
    e.classList.add('clickable');
    e.setAttribute('position',p);
    e.setAttribute('scale','0.6 0.6 0.6');
    e.setAttribute('gltf-model',`#${type}`);
    e.setAttribute('animation__rot','property:rotation;to:0 360 0;loop:true;dur:20000;easing:linear');

    e.addEventListener('click',()=>{ if(!active)return;
      scores[type]++;
      document.getElementById(type+'-fill').style.width=Math.min(scores[type]*10,100)+'%';
      
      // ВЗРЫВ ИЗ ЧАСТИЦ — РАБОТАЕТ НА ВСЕХ ТЕЛЕФОНАХ
      for(let j=0;j<25;j++){
        const p=document.createElement('a-sphere');
        p.setAttribute('radius',0.08+Math.random()*0.12);
        p.setAttribute('color',['#ff4400','#ff8800','#ffff00','#ff0000'][Math.floor(Math.random()*4)]);
        p.setAttribute('position',e.getAttribute('position'));
        p.setAttribute('material','transparent:true;opacity:1');
        p.setAttribute('animation__s','property:scale;from:0.1 0.1 0.1;to:3 3 3;dur:800;easing:easeOutCubic');
        p.setAttribute('animation__m','property:position;to:${(Math.random()-0.5)*8} ${(Math.random()*3+1)} ${(Math.random()-0.5)*8};dur:1000;easing:easeOutQuad');
        p.setAttribute('animation__f','property:material.opacity;to:0;dur:1000');
        sceneEl.appendChild(p);
        setTimeout(()=>p.remove(),1100);
      }
      
      // Звук
      const s=document.createElement('a-entity');
      s.setAttribute('sound','src:#boom;autoplay:true');
      sceneEl.appendChild(s);
      
      e.remove();
    });

    e.addEventListener('model-loaded',()=>{ const t=()=>{if(e.isConnected){e.object3D.lookAt(sceneEl.camera.el.object3D.position);e.object3D.rotateY(Math.PI);requestAnimationFrame(t)};t(); });

    models.appendChild(e);
  });

  let t=30;
  document.getElementById('timer').textContent='30';
  timer=setInterval(()=>{t--;document.getElementById('timer').textContent=t;if(t<=0){active=false;alert('Время вышло!\nУничтожено: '+(scores.nerv+scores.anx+scores.stress));}},1000);
};
</script>
</body>
</html>
